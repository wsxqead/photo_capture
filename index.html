<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./favicon-16x16.png"
    />
    <link rel="manifest" href="./site.webmanifest" />
    <link rel="mask-icon" href="./safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <title>스텔라이브 네컷</title>
    <meta name="title" content="스텔라이브 네컷 | 드림미디어" />
    <meta
      name="description"
      content="스텔라이브 맴버들과의 추억을 모아보세요"
    />

    <style>
      body {
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #f0f0f0;
      }

      .container {
        width: 390px;
        margin-bottom: 100px;
      }

      .member-selection,
      .frame-selection {
        display: flex;
        justify-content: center;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .member-option,
      .frame-option {
        width: 70px;
        height: 90px;
        margin: 10px;
        cursor: pointer;
        border: 2px solid transparent;
        background-size: cover;
        background-position: center;
        line-height: 90px;
        text-align: center;
      }

      .member-option span {
        font-size: 0;
      }

      .frame-option {
        border: 2px solid #ccc;
      }

      /* 멤버 예시 이미지 */
      #member1 {
        background-image: url("icon/original_7.png");
        background-repeat: no-repeat;
      }
      #member2 {
        background-image: url("icon/original_1.png");
        background-repeat: no-repeat;
      }
      #member3 {
        background-image: url("icon/original_11.png");
        background-repeat: no-repeat;
      }
      #member4 {
        background-image: url("icon/original_5.png");
        background-repeat: no-repeat;
      }

      /* 기본 색상 프레임 */
      .basic-frame {
        background-color: #f0f0f0;
      }
      #basic1 {
        background-color: #000000;
        color: #fff;
      }
      #basic2 {
        background-color: #ffe3bf;
      }

      .photos {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        position: relative;
      }

      .photo-frame {
        background-color: white;
        margin: 15px 10px;
        position: relative;
        border: 2px solid #ddd;
        overflow: hidden;
        flex: 1 1 calc(50% - 20px);
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .photo-frame img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .photo-frame input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      .remove-button {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: rgba(255, 255, 255, 0.7);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        padding: 5px;
        display: none;
      }

      .photo-frame:hover .remove-button {
        display: block;
      }

      .overlay-image {
        position: absolute;
        width: 100px;
        height: 100px;
        pointer-events: none;
      }

      .overlay-image.overlay1 {
        top: 10px;
        left: 10px;
      }

      .overlay-image.overlay2 {
        bottom: 10px;
        right: 10px;
      }

      .overlay-bottom {
        bottom: 10px !important;
        top: auto !important;
      }

      .photo-container {
        position: relative;
        background-color: #ffe3bf;
        border: 1px solid #cecece;
        padding-top: 10px;
        padding-left: 10px;
        padding-right: 10px;
      }

      .footer {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 0;
      }

      .f-title {
        font-size: 25px;
        font-weight: 900;
        color: white;
        margin-bottom: 40px;
      }

      .f-date {
        font-size: 15px;
        font-weight: 500;
        color: white;
        margin-bottom: 40px;
      }

      .save-button {
        display: block;
        margin: 20px auto;
        padding: 10px 20px;
        background-color: white;
        border: 1px solid #e1e1e1;
        border-radius: 5px;
        cursor: pointer;
        display: none; /* Initially hidden */
      }

      .reset-button {
        margin: 20px auto;
        padding: 10px 20px;
        background-color: #ffaaaa;
        border: 1px solid #e1e1e1;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="member-selection">
        <div class="member-option" id="member1" data-color="#e4f5c8">
          <span>리코</span>
        </div>
        <div class="member-option" id="member2" data-color="#e2d4f8">
          <span>시부키</span>
        </div>
        <div class="member-option" id="member3" data-color="#ff829e">
          <span>나나</span>
        </div>
        <div class="member-option" id="member4" data-color="#284ce6">
          <span>린</span>
        </div>
        <div class="basic-frame member-option" id="basic1" data-color="#000000">
          Basic 1
        </div>
        <div class="basic-frame member-option" id="basic2" data-color="#ffe3bf">
          Basic 2
        </div>
        <button class="reset-button" onclick="resetSelection()">Reset</button>
      </div>
      <div class="frame-selection">
        <div id="frame1" class="frame-option" style="background-color: #f5f5f5">
          A
        </div>
        <div id="frame2" class="frame-option" style="background-color: #e5e5e5">
          B
        </div>
        <div id="frame3" class="frame-option" style="background-color: #d5d5d5">
          C
        </div>
        <div id="frame4" class="frame-option" style="background-color: #cccccc">
          D
        </div>
      </div>
      <div class="photo-container">
        <div class="photos" id="photo-area">
          <!-- 사진 프레임이 여기에 동적으로 추가됩니다. -->
        </div>
        <div class="footer">
          <p class="f-title">Stel Live</p>
          <p class="f-date" id="current-date"></p>
        </div>
        <img
          id="overlay-image1"
          class="overlay-image overlay1"
          style="display: none"
        />
        <img
          id="overlay-image2"
          class="overlay-image overlay2"
          style="display: none"
        />
      </div>
      <button class="save-button" id="save-button" onclick="saveImage()">
        Save Image
      </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.10.0/dist/html-to-image.min.js"></script>
    <script>
      document.getElementById("current-date").innerText = new Date()
        .toISOString()
        .split("T")[0];

      const defaultBackgroundColor = "#ffe3bf";

      function resetSelection() {
        document.querySelector(".photo-container").style.backgroundColor =
          defaultBackgroundColor;
        document.getElementById("overlay-image1").style.display = "none";
        document.getElementById("overlay-image2").style.display = "none";
        document.getElementById("save-button").style.display = "none"; // Hide the save button
      }

      // 멤버 선택 시 색상 및 오버레이 이미지 설정
      document
        .querySelectorAll(".member-option, .basic-frame")
        .forEach((member) => {
          member.addEventListener("click", () => {
            const selectedMemberColor = member.getAttribute("data-color");
            document.querySelector(".photo-container").style.backgroundColor =
              selectedMemberColor;

            const overlayImage1 = document.getElementById("overlay-image1");
            const overlayImage2 = document.getElementById("overlay-image2");

            if (member.classList.contains("basic-frame")) {
              overlayImage1.style.display = "none";
              overlayImage2.style.display = "none";
            } else {
              switch (member.id) {
                case "member1":
                  overlayImage1.src =
                    "https://photo-capture.vercel.app/icon/original_7.png";
                  overlayImage2.src =
                    "https://photo-capture.vercel.app/icon/original_8.png";
                  break;
                case "member2":
                  overlayImage1.src =
                    "https://photo-capture.vercel.app/icon/original_1.png";
                  overlayImage2.src =
                    "https://photo-capture.vercel.app/icon/original_9.png";
                  break;
                case "member3":
                  overlayImage1.src =
                    "https://photo-capture.vercel.app/icon/original_11.png";
                  overlayImage2.src =
                    "https://photo-capture.vercel.app/icon/original_17.png";
                  break;
                case "member4":
                  overlayImage1.src =
                    "https://photo-capture.vercel.app/icon/original_5.png";
                  overlayImage2.src =
                    "https://photo-capture.vercel.app/icon/original_10.png";
                  break;
                default:
                  overlayImage1.style.display = "none";
                  overlayImage2.style.display = "none";
                  document.querySelector(
                    ".photo-container"
                  ).style.backgroundColor = defaultBackgroundColor;
                  return;
              }
              overlayImage1.style.display = "block";
              overlayImage2.style.display = "block";
            }

            document.getElementById("save-button").style.display = "block"; // Show the save button
          });
        });

      // 프레임 선택 시 레이아웃 변경 및 오버레이 위치 조정
      document.querySelectorAll(".frame-option").forEach((frame) => {
        frame.addEventListener("click", () => {
          const photoArea = document.getElementById("photo-area");
          const overlayImage1 = document.getElementById("overlay-image1");

          photoArea.innerHTML = ""; // 기존 프레임 제거
          switch (frame.id) {
            case "frame1":
              createPhotoFrames(photoArea, 2, 2);
              overlayImage1.classList.remove("overlay-bottom");
              break;
            case "frame2":
              createPhotoFrames(photoArea, 1, 3);
              overlayImage1.classList.add("overlay-bottom");
              break;
            case "frame3":
              createPhotoFrames(photoArea, 3, 1);
              overlayImage1.classList.remove("overlay-bottom");
              break;
            case "frame4":
              createPhotoFrames(photoArea, 1, 2);
              overlayImage1.classList.remove("overlay-bottom");
              break;
            default:
              createPhotoFrames(photoArea, 1, 1);
              overlayImage1.classList.remove("overlay-bottom");
          }
        });
      });

      function createPhotoFrames(container, rows, cols) {
        for (let i = 0; i < rows * cols; i++) {
          const frame = document.createElement("div");
          frame.className = "photo-frame";
          frame.style.flex = `1 1 calc(100% / ${cols} - 20px)`;
          frame.innerHTML = `
          <input type="file" accept="image/*" onchange="loadImage(event, 'img${
            i + 1
          }')">
          <img id="img${i + 1}" src="" alt="" style="display: none">
          <button class="remove-button" onclick="removeImage('${
            i + 1
          }')">X</button>
        `;
          container.appendChild(frame);
        }
      }

      function loadImage(event, id) {
        const reader = new FileReader();
        reader.onload = function () {
          const imgElement = document.getElementById(id);
          imgElement.src = reader.result;
          imgElement.style.display = "block";
        };
        reader.readAsDataURL(event.target.files[0]);
      }

      function removeImage(id) {
        const imgElement = document.getElementById(`img${id}`);
        imgElement.src = "";
        imgElement.style.display = "none";
        // 입력 요소를 초기화하여 같은 이미지를 다시 업로드할 수 있게 함
        const inputElement = imgElement.previousElementSibling;
        inputElement.value = "";
      }

      function saveImage() {
        const container = document.querySelector(".photo-container");
        const currentDate = new Date();
        const fileName = `photo_${currentDate.getFullYear()}${String(
          currentDate.getMonth() + 1
        ).padStart(2, "0")}${String(currentDate.getDate()).padStart(
          2,
          "0"
        )}_${String(currentDate.getHours()).padStart(2, "0")}${String(
          currentDate.getMinutes()
        ).padStart(2, "0")}${String(currentDate.getSeconds()).padStart(
          2,
          "0"
        )}.png`;

        htmlToImage
          .toPng(container)
          .then((dataUrl) => {
            const link = document.createElement("a");
            link.download = fileName;
            link.href = dataUrl;
            link.click();
          })
          .catch((error) => {
            console.error("Error generating image:", error);
          });
      }
    </script>
  </body>
</html>
